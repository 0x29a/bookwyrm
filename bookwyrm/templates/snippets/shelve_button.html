{% load bookwyrm_tags %}
{% if request.user.is_authenticated %}

{% with book.id|uuid as uuid %}
{% active_shelf book as active_shelf %}
<div class="field has-addons">
    {% if switch_mode and active_shelf.book != book %}
    <div class="control">
        {% include 'snippets/switch_edition_button.html' with edition=book size='is-small' %}
    </div>
    {% else %}
    <div class="control">
        {% include 'snippets/shelve_button_options.html' with class="shelf-option is-small" shelves=request.user.shelf_set.all active_shelf=active_shelf %}
    </div>
    {% include 'snippets/shelve_button_dropdown.html' with class="is-small" button_uuid=uuid%}
    {% endif %}
</div>

{% include 'snippets/start_reading_modal.html' with book=active_shelf.book controls_text="start-reading" controls_uid=uuid %}

{% latest_read_through book request.user as readthrough %}
{% include 'snippets/finish_reading_modal.html' with book=active_shelf.book controls_text="finish-reading" controls_uid=uuid readthrough=readthrough %}

{% endwith %}
{% endif %}
